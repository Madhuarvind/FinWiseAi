{
  "entities": {
    "Transaction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Transaction",
      "type": "object",
      "description": "Represents a financial transaction.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the transaction."
        },
        "transactionDate": {
          "type": "string",
          "description": "The date and time when the transaction occurred.",
          "format": "date-time"
        },
        "description": {
          "type": "string",
          "description": "A textual description of the transaction (e.g., 'Starbucks - $12.50')."
        },
        "amount": {
          "type": "number",
          "description": "The monetary amount of the transaction."
        },
        "categoryId": {
          "type": "string",
          "description": "Reference to the Category. (Relationship: Category 1:N Transaction)"
        },
        "userProfileId": {
          "type": "string",
          "description": "Reference to the UserProfile. (Relationship: UserProfile 1:N Transaction)"
        },
        "confidenceScore": {
          "type": "number",
          "description": "Confidence score assigned to the transaction categorization."
        },
        "explanation": {
          "type": "string",
          "description": "Explanation of the transaction classification, potentially generated by XAI."
        }
      },
      "required": [
        "id",
        "transactionDate",
        "description",
        "amount",
        "categoryId",
        "userProfileId"
      ]
    },
    "Category": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Category",
      "type": "object",
      "description": "Represents a category for financial transactions (e.g., 'Dining', 'Fuel', 'Shopping').",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the category."
        },
        "name": {
          "type": "string",
          "description": "The name of the category (e.g., 'Dining')."
        },
        "description": {
          "type": "string",
          "description": "A description of the category."
        },
        "rules": {
          "type": "string",
          "description": "JSON containing fuzzy-matching or keyword-based rules."
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user profile.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user profile, matching the Firebase Auth UID."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "firstName": {
          "type": "string",
          "description": "The user's first name."
        },
        "lastName": {
          "type": "string",
          "description": "The user's last name."
        },
        "registrationDate": {
          "type": "string",
          "description": "The date and time the user registered.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "email",
        "firstName",
        "lastName"
      ]
    },
    "Policy": {
      "title": "Policy",
      "type": "object",
      "description": "A structured policy object that defines categorization rules.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the policy." },
        "name": { "type": "string", "description": "A short, human-readable name for the policy." },
        "naturalLanguage": { "type": "string", "description": "The original policy text in plain English." },
        "conditions": {
          "type": "object",
          "properties": {
            "merchant": { "type": "array", "items": { "type": "string" } },
            "dayOfWeek": { "type": "array", "items": { "type": "string" } }
          }
        },
        "action": {
          "type": "object",
          "properties": {
            "type": { "type": "string", "enum": ["CLASSIFY"] },
            "category": { "type": "string" }
          }
        },
        "createdAt": { "type": "string", "format": "date-time" }
      },
      "required": ["id", "name", "naturalLanguage", "conditions", "action"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "google.com"
    ]
  },
  "firestore": {
    "/users/{userId}": {
      "schema": {
        "$ref": "#/entities/UserProfile"
      },
      "description": "Stores user profile information. The `userId` parameter is the Firebase Authentication UID."
    },
    "/categories/{categoryId}": {
      "schema": {
        "$ref": "#/entities/Category"
      },
      "description": "Stores transaction categories. Access control for creation/modification may rely on a separate admin role collection."
    },
    "/users/{userId}/transactions/{transactionId}": {
      "schema": {
        "$ref": "#/entities/Transaction"
      },
      "description": "Stores financial transactions for a specific user. Path-based ownership ensures only the authenticated user can read/write their own transactions."
    },
    "/policies/{policyId}": {
      "schema": {
        "$ref": "#/entities/Policy"
      },
      "description": "Stores versioned, machine-readable policies for the Policy-Driven Categorisation OS (PD-COS)."
    }
  }
}
